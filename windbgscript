#$WinDbgPath = "c:\Program Files (x86)\Windows Kits\10\Debuggers\x64\windbg.exe"
$POC_PATH = "C:\Users\admin\Documents\poc.html"

$o = Get-Process -Name MicrosoftEdge -erroraction 'silentlycontinue'
if ($o.length -gt 0){
    ForEach ($pr in $o) {
        $pr.Kill()
    }
}

$o = Get-Process -Name MicrosoftEdgeSH -erroraction 'silentlycontinue'
if ($o.length -gt 0){
    ForEach ($pr in $o) {
        $pr.Kill()
    }
}

$o = Get-Process -Name MicrosoftEdgeCP -erroraction 'silentlycontinue'
if ($o.length -gt 0){
    ForEach ($pr in $o) {
        $pr.Kill()
    }
}
Start-Sleep -Millisecond 500
Invoke-Item $POC_PATH
Start-Sleep -Millisecond 1500

$p = Get-Process -Name MicrosoftEdgeCP 
$scriptPath = split-path -parent $MyInvocation.MyCommand.Definition
ForEach ($pr in $p) {
    Write-Host ("Attaching to {0}" -f ($pr.Id))
    $aargs = '-p {0} -c "$<{1}"' -f ($pr.Id, (Join-Path $scriptPath "windbgscript.txt"))
    Start-Process -FilePath WinDbgX -ArgumentList $aargs
}
